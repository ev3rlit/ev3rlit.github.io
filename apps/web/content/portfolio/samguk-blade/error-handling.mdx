---
title: "에러 핸들링 체계 도입"
description: "핫픽스 대응 시간을 8배 단축한 에러 추적 시스템 설계"
project: "samguk-blade"
projectTitle: "삼국 블레이드 키우기"
tags: ["Architecture", "Error Handling", "Observability"]
order: 1
---

## TL;DR

에러 추적 체계 없이 운영하던 이전 프로젝트에서 문제 대응에 하루 이상 걸리는 경험을 했습니다. 이 교훈을 바탕으로 프로젝트 초기부터 **error as value 패턴**과 **에러 컨텍스트 자동 수집 체계**를 설계하여, 핫픽스 대응 시간을 **1일 → 1~2시간**으로 단축했습니다.

---

## 배경

이전 프로젝트(BladeX)에서 에러 추적 체계 없이 라이브 서비스를 운영했습니다.

문제가 발생하면:
- 에러가 어디서 왜 발생했는지 알 수 없음
- 추측으로 코드를 뒤져야 함
- **원인 파악에만 하루 이상 소요**
- DB를 직접 수정해야 하는 상황 빈번

이 경험을 통해 "에러 추적 체계는 선택이 아닌 필수"라는 교훈을 얻었습니다.

---

## 문제 정의

```
에러 발생 → 원인 파악 불가 → 추측으로 디버깅 → 해결까지 1일+
```

핵심 문제:
1. **에러 발생 지점 불명확**: 어느 함수에서 에러가 발생했는지 모름
2. **컨텍스트 부재**: 에러 발생 당시 상황 정보 없음
3. **재현 불가**: 같은 에러를 재현하기 어려움

---

## 해결 방안

### 1. Error as Value 패턴 도입

Go의 error as value 철학을 적극 활용했습니다.

```go
// Before: 에러 정보가 메시지뿐
return errors.New("failed to update user")

// After: 구조화된 에러 정보
return errs.Wrap(err, errs.Context{
    "userId":    userId,
    "action":    "updateInventory",
    "itemId":    itemId,
    "quantity":  quantity,
})
```

### 2. 에러 컨텍스트 자동 수집

모든 에러에 다음 정보가 자동으로 포함되도록 설계했습니다:

| 정보 | 용도 |
|-----|-----|
| 요청 인자 | 어떤 입력으로 에러가 발생했는지 |
| 코드 위치 | 파일명, 라인 번호 |
| 스택 트레이스 | 호출 흐름 추적 |
| 사용자 ID | 영향받은 유저 특정 |
| 함수명 | 어떤 작업 중 발생했는지 |
| 발생 시간 | 시간대별 패턴 분석 |

### 3. 전역 미들웨어 적용

150개+ API에 에러 핸들링 미들웨어를 일괄 적용했습니다.

```go
func ErrorMiddleware(next Handler) Handler {
    return func(ctx *Context) error {
        err := next(ctx)
        if err != nil {
            // 자동으로 컨텍스트 수집 및 로깅
            logError(ctx, err)
            // 클라이언트에는 안전한 에러 응답
            return toClientError(err)
        }
        return nil
    }
}
```

---

## 결과

### Before
```
에러 발생 → 로그에서 추측 → 코드 검색 → 재현 시도 → 원인 파악 (1일+)
```

### After
```
에러 발생 → 대시보드에서 컨텍스트 확인 → 즉시 원인 파악 (1~2시간)
```

**핫픽스 대응 시간 8배 단축** (1일 → 1~2시간)

---

## 배운 점

1. **에러 추적 체계는 프로젝트 초기에 구축해야 한다**
   - 나중에 추가하면 기존 코드 전체 수정 필요

2. **에러 메시지보다 컨텍스트가 중요하다**
   - "failed to update" 보다 "userId=123, itemId=456일 때 실패"가 유용

3. **개발자 경험(DX)이 운영 품질에 직결된다**
   - 에러 추적이 쉬우면 문제 해결도 빨라짐
